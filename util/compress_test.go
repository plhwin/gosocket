package util

import (
	fmt "fmt"
	"strconv"
	"testing"

	"github.com/plhwin/gosocket/protocol"
)

var transportProtocol = "binary"

func TestZipAndUnZip(t *testing.T) {
	size := 2
	datasSlice := make([][]byte, size)
	for i := 0; i < size; i++ {
		s := `["kline",{"result":true,"message":"ok","data":{"charts":"1610574000|1.21581|1.21558|1.21562|1.21578|76;1610574060|1.21576|1.21568|1.21571|1.21574|62;1610574120|1.2158|1.21569|1.21573|1.21571|103;1610574180|1.21571|1.21558|1.21566|1.21558|100;1610574240|1.21567|1.21556|1.2156|1.21561|125;1610574300|1.21586|1.2156|1.21562|1.21583|140;1610574360|1.21584|1.21572|1.2158|1.21574|35;1610574420|1.21577|1.2156|1.21574|1.21567|61;1610574480|1.21564|1.21552|1.21561|1.21554|100;1610574540|1.21556|1.21548|1.21548|1.21556|71;1610574600|1.21565|1.21554|1.21554|1.21562|63;1610574660|1.21566|1.21562|1.21562|1.21564|38;1610574720|1.21572|1.21558|1.21558|1.21569|105;1610574780|1.2158|1.2157|1.2157|1.21577|94;1610574840|1.2158|1.21572|1.21576|1.21573|93;1610574900|1.21566|1.21552|1.21563|1.21554|114;1610574960|1.21557|1.21552|1.21554|1.21554|29;1610575020|1.21558|1.21551|1.21553|1.21557|125;1610575080|1.21558|1.21531|1.21555|1.21531|100;1610575140|1.21555|1.21523|1.21532|1.21531|177;1610575200|1.21558|1.21539|1.21541|1.21553|140;1610575260|1.2156|1.21542|1.21555|1.21559|111;1610575320|1.21562|1.21547|1.21557|1.21548|141;1610575380|1.2155|1.21536|1.21547|1.21536|72;1610575440|1.2155|1.21538|1.21539|1.21548|77;1610575500|1.21554|1.21547|1.21549|1.21552|71;1610575560|1.21556|1.21551|1.21551|1.21553|61;1610575620|1.2156|1.21549|1.21549|1.21556|48;1610575680|1.21558|1.21544|1.21556|1.21547|42;1610575740|1.21553|1.21544|1.21544|1.21547|47;1610575800|1.21566|1.21548|1.21548|1.21564|71;1610575860|1.21568|1.21556|1.21565|1.21558|52;1610575920|1.21565|1.21552|1.21562|1.21554|107;1610575980|1.21556|1.21545|1.21552|1.21555|81;1610576040|1.21561|1.21555|1.21555|1.21558|51;1610576100|1.2156|1.21555|1.21558|1.21557|65;1610576160|1.2156|1.21545|1.21558|1.21545|76;1610576220|1.21553|1.21546|1.21546|1.2155|80;1610576280|1.21561|1.21547|1.21548|1.21561|73;1610576340|1.21566|1.21556|1.21559|1.21565|71;1610576400|1.21566|1.21549|1.21563|1.21549|76;1610576460|1.21552|1.21547|1.21548|1.21547|89;1610576520|1.21556|1.21545|1.21546|1.21554|53;1610576580|1.21562|1.21556|1.2156|1.21557|55;1610576640|1.21562|1.21552|1.21556|1.21557|107;1610576700|1.21557|1.21549|1.21556|1.21549|66;1610576760|1.21552|1.21542|1.2155|1.21548|64;1610576820|1.21568|1.21548|1.21549|1.21568|109;1610576880|1.21568|1.21556|1.21566|1.2156|133;1610576940|1.21569|1.21558|1.21558|1.21568|150;1610577000|1.21572|1.21551|1.21566|1.21568|151;1610577060|1.21569|1.21551|1.21566|1.21556|91;1610577120|1.21558|1.21549|1.21555|1.2155|148;1610577180|1.21555|1.2154|1.21551|1.2154|73;1610577240|1.21549|1.21539|1.21541|1.21549|62;1610577300|1.21549|1.21539|1.21547|1.21544|47;1610577360|1.21544|1.21542|1.21542|1.21543|14;1610577420|1.21542|1.21532|1.21542|1.21535|16;1610577480|1.21533|1.21517|1.21533|1.21525|66;1610577540|1.21526|1.21515|1.21523|1.21519|100;1610577600|1.21523|1.21494|1.21513|1.21503|112;1610577660|1.21525|1.21501|1.21501|1.2152|131;1610577720|1.21521|1.21512|1.21515|1.21513|78;1610577780|1.21525|1.21513|1.21513|1.21525|92;1610577840|1.21537|1.21527|1.21527|1.21532|116;1610577900|1.21545|1.21531|1.21532|1.21543|116;1610577960|1.21546|1.21536|1.21538|1.21537|92;1610578020|1.21539|1.21532|1.21536|1.21536|75;1610578080|1.2154|1.21519|1.21537|1.2152|122;1610578140|1.21522|1.21512|1.21518|1.21512|82;1610578200|1.21514|1.21507|1.21512|1.21509|84;1610578260|1.21505|1.21493|1.21502|1.21494|101;1610578320|1.21507|1.21493|1.21493|1.21507|106;1610578380|1.21507|1.2148|1.21504|1.21485|88;1610578440|1.21516|1.21483|1.21483|1.21514|114;1610578500|1.21526|1.21509|1.21516|1.21518|76;1610578560|1.21534|1.21513|1.21517|1.21515|95;1610578620|1.21542|1.21515|1.21516|1.21542|82;1610578680|1.21542|1.21528|1.2154|1.21534|98;1610578740|1.21545|1.21531|1.21532|1.21543|87;1610578800|1.21556|1.21549|1.21554|1.2155|134;1610578860|1.21567|1.2155|1.2155|1.21562|107;1610578920|1.21567|1.21561|1.21561|1.21565|59;1610578980|1.21566|1.2156|1.21561|1.2156|117;1610579040|1.21557|1.21549|1.21554|1.21552|96;1610579100|1.21556|1.21549|1.21551|1.21553|46;1610579160|1.2156|1.21554|1.21554|1.21557|39;1610579220|1.21561|1.21556|1.21556|1.2156|14;1610579280|1.21565|1.21544|1.21561|1.21546|65;1610579340|1.21562|1.21545|1.21545|1.2156|33;1610579400|1.21569|1.21558|1.21559|1.21566|72;1610579460|1.21574|1.21565|1.21567|1.2157|93;1610579520|1.21572|1.21568|1.21569|1.21571|29;1610579580|1.21573|1.21568|1.21569|1.21571|47;1610579640|1.21568|1.21564|1.21565|1.21566|44;1610579700|1.21569|1.21564|1.21565|1.21565|49;1610579760|1.21569|1.21564|1.21566|1.21564|62;1610579820|1.21566|1.21558|1.21563|1.21561|86;1610579880|1.21566|1.21556|1.21559|1.21558|76;1610579940|1.2156|1.21554|1.21558|1.21555|50;1610580000|1.21554|1.21541|1.21552|1.21542|68;1610580060|1.21536|1.21526|1.21534|1.21532|43;1610580120|1.21545|1.21533|1.21533|1.21544|69;1610580180|1.21563|1.21541|1.21541|1.21561|130;1610580240|1.21566|1.2156|1.21562|1.21564|24;1610580300|1.21566|1.2156|1.21565|1.21561|53;1610580360|1.21565|1.21558|1.21561|1.21562|43;1610580420|1.21566|1.21563|1.21563|1.21563|16;1610580480|1.21566|1.21563|1.21563|1.21564|35;1610580540|1.21563|1.21553|1.21554|1.21555|86;1610580600|1.21556|1.21539|1.21553|1.21541|88;1610580660|1.21554|1.21542|1.21544|1.21553|56;1610580720|1.21555|1.21544|1.21552|1.21545|69;1610580780|1.21554|1.21545|1.21545|1.21552|29;1610580840|1.21552|1.21541|1.21549|1.21542|44;1610580900|1.21548|1.21542|1.21542|1.21545|83;1610580960|1.21545|1.21542|1.21543|1.21542|5;1610581080|1.21545|1.21543|1.21543|1.21543|24;1610581140|1.21551|1.21542|1.21542|1.21548|56;1610581200|1.2155|1.21546|1.21548|1.2155|44;1610581260|1.21556|1.21548|1.21548|1.21553|85;1610581320|1.21551|1.21548|1.21548|1.2155|25;1610581380|1.21552|1.21549|1.21549|1.21549|16;1610581440|1.21553|1.21548|1.21549|1.2155|67;1610581500|1.21553|1.21539|1.21551|1.21542|43;1610581560|1.21542|1.2154|1.2154|1.21541|7;1610581620|1.21543|1.2153|1.21541|1.21541|23;1610581680|1.2156|1.21539|1.21539|1.21558|33;1610581740|1.21558|1.21548|1.21558|1.21549|15;1610581860|1.21552|1.21543|1.2155|1.21547|51;1610581920|1.21553|1.21547|1.21547|1.21548|18;1610581980|1.2156|1.21547|1.21547|1.21558|21;1610582040|1.21561|1.21553|1.21558|1.21553|14;1610583000|1.21575|1.21573|1.21573|1.21575|53;1610583060|1.21575|1.21573|1.21573|1.21573|45;1610583300|1.21579|1.21579|1.21579|1.21579|1;1610583420|1.21592|1.21592|1.21592|1.21592|2;1610583480|1.21594|1.21594|1.21594|1.21594|1;1610583540|1.21596|1.21596|1.21596|1.21596|1;1610583600|1.21606|1.21528|1.21599|1.21528|34;1610583660|1.21535|1.21532|1.21532|1.21535|2;1610583720|1.21542|1.21535|1.21535|1.21542|2;1610583780|1.21562|1.21562|1.21562|1.21562|1;1610583840|1.21567|1.21567|1.21567|1.21567|1;1610584080|1.21567|1.21567|1.21567|1.21567|1;1610584200|1.21573|1.21567|1.21567|1.21567|25;1610584260|1.21573|1.21567|1.21567|1.21567|46;1610584860|1.21567|1.21567|1.21567|1.21567|1;1610584920|1.21548|1.21542|1.21542|1.21546|14;1610584980|1.21555|1.21546|1.21546|1.21555|12;1610585040|1.21555|1.21555|1.21555|1.21555|1;1610585400|1.21561|1.21559|1.21559|1.21561|8;1610585460|1.21561|1.21561|1.21561|1.21561|1;1610585640|1.21569|1.21564|1.21564|1.21569|6;1610585700|1.21571|1.21546|1.21569|1.2155|9;1610585760|1.21553|1.21551|1.21551|1.21553|8;1610585940|1.21564|1.21553|1.21558|1.21564|18;1610586000|1.21564|1.21556|1.21564|1.21558|7;1610586060|1.21562|1.21559|1.21559|1.21562|4;1610586240|1.21567|1.21563|1.21563|1.21567|17;1610586300|1.21574|1.21562|1.21568|1.21563|27;1610586360|1.21571|1.21563|1.21563|1.21569|19;1610586420|1.21571|1.21568|1.21569|1.2157|16;1610586480|1.21571|1.21569|1.21569|1.21569|10;1610586540|1.21552|1.2154|1.2154|1.21552|15;1610586600|1.21566|1.21558|1.21558|1.21564|24;1610586660|1.21566|1.21563|1.21563|1.21566|9;1610586840|1.2158|1.21568|1.21568|1.2158|28;1610586900|1.2158|1.21573|1.21578|1.21573|47;1610586960|1.21589|1.21573|1.21573|1.21587|28;1610587020|1.21587|1.21583|1.21583|1.21587|34;1610587080|1.2159|1.21587|1.21587|1.21588|38;1610587140|1.21593|1.21589|1.21589|1.2159|26;1610587200|1.21592|1.21577|1.2159|1.21579|35;1610587260|1.21577|1.21577|1.21577|1.21577|1;1610587320|1.21575|1.21573|1.21573|1.21575|17;1610587380|1.2158|1.21573|1.21573|1.21578|46;1610587440|1.21578|1.21574|1.21574|1.21574|11;1610587620|1.21576|1.21569|1.21573|1.21569|26;1610587680|1.21578|1.21569|1.21569|1.21573|80;1610587740|1.21573|1.21566|1.2157|1.21568|31;1610587800|1.21562|1.21558|1.21558|1.21559|16;1610587860|1.21568|1.21564|1.21564|1.21565|42;1610587920|1.21567|1.21564|1.21566|1.21566|39;1610587980|1.21571|1.21564|1.21564|1.21571|23;1610588040|1.21584|1.2158|1.2158|1.21584|3;1610588100|1.21593|1.21586|1.21586|1.2159|96;1610588160|1.21602|1.21597|1.21597|1.21601|67;1610588220|1.21601|1.21599|1.21599|1.21599|11;1610588280|1.21602|1.21596|1.21596|1.21599|46;1610588340|1.216|1.21596|1.21596|1.21599|20;1610588400|1.21601|1.21597|1.21598|1.21598|7;1610588460|1.21594|1.21592|1.21592|1.21593|12;1610588520|1.21592|1.21587|1.21589|1.21587|34;1610588580|1.21592|1.21587|1.21588|1.21589|60;1610588700|1.21587|1.21583|1.21583|1.21586|20;1610588760|1.21596|1.21588|1.21588|1.21596|16;1610588820|1.21595|1.21593|1.21593|1.21593|6;1610588880|1.21608|1.21604|1.21604|1.21605|37;1610588940|1.21611|1.21606|1.21606|1.21608|25;1610589000|1.21611|1.21605|1.21605|1.21608|76;1610589060|1.21624|1.21609|1.21609|1.21618|92;1610589120|1.21631|1.21619|1.21619|1.21628|41;1610589180|1.21629|1.21614|1.21627|1.21617|63;1610589240|1.2162|1.21613|1.21617|1.21613|42;1610589300|1.21616|1.21613|1.21613|1.21615|5;1610589360|1.21616|1.21613|1.21613|1.21613|16;1610589420|1.21618|1.21614|1.21614|1.21615|19;1610589480|1.21614|1.21608|1.21612|1.21611|25;1610589540|1.21612|1.21609|1.21609|1.2161|7;1610589600|1.21616|1.21596|1.21611|1.21596|93;1610589660|1.21604|1.21594|1.21595|1.21595|83;1610589720|1.21601|1.21594|1.21596|1.21595|45;1610589780|1.216|1.21594|1.21594|1.216|10;1610589840|1.21603|1.21597|1.21598|1.21601|60;1610589900|1.21601|1.21597|1.21598|1.21597|47;1610589960|1.21598|1.21595|1.21596|1.21596|24;1610590140|1.21607|1.21604|1.21604|1.21606|28;1610590200|1.2162|1.21604|1.21605|1.21619|35;1610590260|1.2163|1.21618|1.2162|1.21628|95;1610590320|1.2164|1.21627|1.21629|1.21628|78;1610590380|1.21651|1.21624|1.21624|1.21646|106;1610590440|1.2165|1.21631|1.21644|1.21644|132;1610590500|1.21642|1.21627|1.21637|1.21639|109;1610590560|1.2165|1.21636|1.2164|1.21647|136;1610590620|1.21648|1.21642|1.21642|1.21647|88;1610590680|1.21649|1.21643|1.21645|1.21647|91;1610590740|1.21676|1.21646|1.21646|1.21675|91;1610590800|1.21681|1.21669|1.21675|1.21678|139;1610590860|1.21682|1.21672|1.21679|1.21673|132;1610590920|1.21686|1.21673|1.21673|1.21683|124;1610590980|1.21686|1.21682|1.21682|1.21683|58;1610591040|1.21686|1.21682|1.21684|1.21683|66;1610591100|1.21688|1.21681|1.21684|1.21682|39;1610591160|1.21702|1.21683|1.21683|1.21699|82;1610591220|1.21705|1.21694|1.217|1.21704|72;1610591280|1.21702|1.21698|1.21698|1.217|38;1610591340|1.21701|1.21693|1.21698|1.21695|101;1610591400|1.21702|1.21695|1.21698|1.21698|80;1610591460|1.21697|1.21679|1.21695|1.21679|95;1610591520|1.21682|1.21659|1.2168|1.21663|108;1610591580|1.21668|1.21653|1.21664|1.21659|134;1610591640|1.21667|1.21658|1.21658|1.21661|101;1610591700|1.21667|1.21656|1.2166|1.21656|133;1610591760|1.21656|1.2165|1.21651|1.21651|62;1610591820|1.21655|1.21649|1.21651|1.21651|84;1610591880|1.21655|1.21651|1.21651|1.21651|148;1610591940|1.21655|1.21648|1.21652|1.21655|54;1610592000|1.21657|1.21643|1.21655|1.21643|85;1610592060|1.21649|1.2164|1.21644|1.21645|79;1610592120|1.21649|1.21626|1.21643|1.21631|121;1610592180|1.21637|1.21629|1.21631|1.21637|114;1610592240|1.21643|1.21634|1.21636|1.21636|108;1610592300|1.21643|1.2163|1.21635|1.2164|120;1610592360|1.21646|1.21638|1.2164|1.21643|57;1610592420|1.21648|1.21634|1.21643|1.21639|111;1610592480|1.21647|1.21637|1.21637|1.21639|68;1610592540|1.21645|1.21638|1.21638|1.21643|45;1610592600|1.21651|1.21641|1.21642|1.21642|100;1610592660|1.21647|1.21636|1.21641|1.21646|75;1610592720|1.21645|1.21625|1.21643|1.21633|128;1610592780|1.21637|1.21628|1.21634|1.21628|134;1610592840|1.21633|1.21621|1.21628|1.2163|98;1610592900|1.21633|1.21618|1.21631|1.21631|147;1610592960|1.21649|1.21626|1.21631|1.21649|116;1610593020|1.21655|1.21645|1.21653|1.21646|57;1610593080|1.2165|1.21637|1.21648|1.21641|106;1610593140|1.21644|1.21635|1.21639|1.21637|89;1610593200|1.21645|1.21632|1.21632|1.2164|70;1610593260|1.21644|1.2163|1.21639|1.21644|47;1610593320|1.21658|1.21643|1.21643|1.21657|152;1610593380|1.21663|1.21654|1.21658|1.21656|117;1610593440|1.21663|1.21653|1.21656|1.21658|76;1610593500|1.21661|1.21642|1.21657|1.21644|128;1610593560|1.21648|1.21641|1.21641|1.21647|125;1610593620|1.21652|1.2164|1.21645|1.21652|63;1610593680|1.21658|1.21645|1.21655|1.21653|100;1610593740|1.21654|1.21645|1.21645|1.21649|114;1610593800|1.21668|1.21647|1.21647|1.21665|117;1610593860|1.21669|1.2166|1.21664|1.21668|31;1610593920|1.21672|1.21663|1.21663|1.21668|114;1610593980|1.21675|1.21666|1.21669|1.21668|79;1610594040|1.21667|1.2166|1.21666|1.2166|69;1610594100|1.21663|1.21644|1.21661|1.21646|47;1610594160|1.2167|1.21643|1.21647|1.21667|137;1610594220|1.21709|1.21668|1.21668|1.21689|119;1610594280|1.21707|1.21684|1.21684|1.21705|94;1610594340|1.21698|1.21685|1.21695|1.21692|84;1610594400|1.217|1.21671|1.21693|1.21675|158;1610594460|1.21685|1.21674|1.21682|1.21677|84;1610594520|1.21687|1.21675|1.21681|1.21686|66;1610594580|1.21691|1.2168|1.21685|1.2169|51;1610594640|1.21699|1.21688|1.21688|1.21696|106;1610594700|1.21698|1.21691|1.21694|1.21693|77;1610594760|1.21697|1.21689|1.21691|1.21694|119;1610594820|1.21694|1.21671|1.21691|1.21673|176;1610594880|1.21679|1.21668|1.21673|1.21668|77;1610594940|1.2167|1.21663|1.21663|1.21665|74;1610595000|1.21682|1.21668|1.21668|1.21674|42;1610595060|1.21678|1.21667|1.21675|1.21667|112","mt4TimeZone":"Europe/Moscow","period":"M1","serverTime":1610595111,"symbol":"EURUSD"}},"dhf3J9DhPvnObQQT8YW62LKTThrHfDPn"]`
		s = `["ping",1234567891012]`
		s += fmt.Sprintf("%d", i)

		args := `"XAGUSD.pro|1610603557|25.277@81210;25.273@25000;25.271@5000;25.271@5000;25.27@15000|25.327@78980;25.328@5000;25.328@5000;25.329@15000;25.331@25000"`
		//args += fmt.Sprintf("%d", i)
		id := fmt.Sprintf("JDSKJXARU8X384JXld83jxX9D2j37xK%d", i)

		msg, _ := protocol.Encode("quote-fix", args, id, transportProtocol)

		//msg, _ = EnPack(msg)

		datasSlice[i] = msg
		fmt.Println("raw size:", strconv.Itoa(i)+":", len(datasSlice[i]))
	}

	for i := 0; i < size; i++ {
		b, err := Zip(datasSlice[i])
		fmt.Println("gzip size:", err, len(b))

		m, err2 := Unzip(b)
		message, err3 := protocol.Decode(m, transportProtocol)

		fmt.Println("ungzip size:", err, err2, err3, len(m), message)
	}
}
